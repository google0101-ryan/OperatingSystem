section .text
extern isr_common

; Interrupt service routines
isr0:
	cli
	push 0
	push 0
	jmp isr_common
isr1:
	cli
	push 0
	push 1
	jmp isr_common
isr2:
	cli
	push 0
	push 2
	jmp isr_common
isr3:
	cli
	push 0
	push 3
	jmp isr_common
isr4:
	cli
	push 0
	push 4
	jmp isr_common
isr5:
	cli
	push 0
	push 5
	jmp isr_common
isr6:
	cli
	push 0
	push 6
	jmp isr_common
isr7:
	cli
	push 0
	push 7
	jmp isr_common
isr8:
	cli
	nop
	push 8
	jmp isr_common
isr9:
	cli
	push 0
	push 9
	jmp isr_common
isr10:
	cli
	nop
	push 10
	jmp isr_common
isr11:
	cli
	nop
	push 11
	jmp isr_common
isr12:
	cli
	nop
	push 12
	jmp isr_common
isr13:
	cli
	nop
	push 13
	jmp isr_common
isr14:
	cli
	nop
	push 14
	jmp isr_common
isr15:
	cli
	push 0
	push 15
	jmp isr_common
isr16:
	cli
	push 0
	push 16
	jmp isr_common
isr17:
	cli
	nop
	push 17
	jmp isr_common
isr18:
	cli
	push 0
	push 18
	jmp isr_common
isr19:
	cli
	push 0
	push 19
	jmp isr_common
isr20:
	cli
	push 0
	push 20
	jmp isr_common
isr21:
	cli
	push 0
	push 21
	jmp isr_common
isr22:
	cli
	push 0
	push 22
	jmp isr_common
isr23:
	cli
	push 0
	push 23
	jmp isr_common
isr24:
	cli
	push 0
	push 24
	jmp isr_common
isr25:
	cli
	push 0
	push 25
	jmp isr_common
isr26:
	cli
	push 0
	push 26
	jmp isr_common
isr27:
	cli
	push 0
	push 27
	jmp isr_common
isr28:
	cli
	push 0
	push 28
	jmp isr_common
isr29:
	cli
	push 0
	push 29
	jmp isr_common
isr30:
	cli
	push 0
	push 30
	jmp isr_common
isr31:
	cli
	push 0
	push 31
	jmp isr_common
isr32:
	cli
	push 0
	push 32
	jmp isr_common
isr33:
	cli
	push 0
	push 33
	jmp isr_common
isr34:
	cli
	push 0
	push 34
	jmp isr_common
isr35:
	cli
	push 0
	push 35
	jmp isr_common
isr36:
	cli
	push 0
	push 36
	jmp isr_common
isr37:
	cli
	push 0
	push 37
	jmp isr_common
isr38:
	cli
	push 0
	push 38
	jmp isr_common
isr39:
	cli
	push 0
	push 39
	jmp isr_common
isr40:
	cli
	push 0
	push 40
	jmp isr_common
isr41:
	cli
	push 0
	push 41
	jmp isr_common
isr42:
	cli
	push 0
	push 42
	jmp isr_common
isr43:
	cli
	push 0
	push 43
	jmp isr_common
isr44:
	cli
	push 0
	push 44
	jmp isr_common
isr45:
	cli
	push 0
	push 45
	jmp isr_common
isr46:
	cli
	push 0
	push 46
	jmp isr_common
isr47:
	cli
	push 0
	push 47
	jmp isr_common
isr48:
	cli
	push 0
	push 48
	jmp isr_common
isr49:
	cli
	push 0
	push 49
	jmp isr_common
isr50:
	cli
	push 0
	push 50
	jmp isr_common
isr51:
	cli
	push 0
	push 51
	jmp isr_common
isr52:
	cli
	push 0
	push 52
	jmp isr_common
isr53:
	cli
	push 0
	push 53
	jmp isr_common
isr54:
	cli
	push 0
	push 54
	jmp isr_common
isr55:
	cli
	push 0
	push 55
	jmp isr_common
isr56:
	cli
	push 0
	push 56
	jmp isr_common
isr57:
	cli
	push 0
	push 57
	jmp isr_common
isr58:
	cli
	push 0
	push 58
	jmp isr_common
isr59:
	cli
	push 0
	push 59
	jmp isr_common
isr60:
	cli
	push 0
	push 60
	jmp isr_common
isr61:
	cli
	push 0
	push 61
	jmp isr_common
isr62:
	cli
	push 0
	push 62
	jmp isr_common
isr63:
	cli
	push 0
	push 63
	jmp isr_common
isr64:
	cli
	push 0
	push 64
	jmp isr_common
isr65:
	cli
	push 0
	push 65
	jmp isr_common
isr66:
	cli
	push 0
	push 66
	jmp isr_common
isr67:
	cli
	push 0
	push 67
	jmp isr_common
isr68:
	cli
	push 0
	push 68
	jmp isr_common
isr69:
	cli
	push 0
	push 69
	jmp isr_common
isr70:
	cli
	push 0
	push 70
	jmp isr_common
isr71:
	cli
	push 0
	push 71
	jmp isr_common
isr72:
	cli
	push 0
	push 72
	jmp isr_common
isr73:
	cli
	push 0
	push 73
	jmp isr_common
isr74:
	cli
	push 0
	push 74
	jmp isr_common
isr75:
	cli
	push 0
	push 75
	jmp isr_common
isr76:
	cli
	push 0
	push 76
	jmp isr_common
isr77:
	cli
	push 0
	push 77
	jmp isr_common
isr78:
	cli
	push 0
	push 78
	jmp isr_common
isr79:
	cli
	push 0
	push 79
	jmp isr_common
isr80:
	cli
	push 0
	push 80
	jmp isr_common
isr81:
	cli
	push 0
	push 81
	jmp isr_common
isr82:
	cli
	push 0
	push 82
	jmp isr_common
isr83:
	cli
	push 0
	push 83
	jmp isr_common
isr84:
	cli
	push 0
	push 84
	jmp isr_common
isr85:
	cli
	push 0
	push 85
	jmp isr_common
isr86:
	cli
	push 0
	push 86
	jmp isr_common
isr87:
	cli
	push 0
	push 87
	jmp isr_common
isr88:
	cli
	push 0
	push 88
	jmp isr_common
isr89:
	cli
	push 0
	push 89
	jmp isr_common
isr90:
	cli
	push 0
	push 90
	jmp isr_common
isr91:
	cli
	push 0
	push 91
	jmp isr_common
isr92:
	cli
	push 0
	push 92
	jmp isr_common
isr93:
	cli
	push 0
	push 93
	jmp isr_common
isr94:
	cli
	push 0
	push 94
	jmp isr_common
isr95:
	cli
	push 0
	push 95
	jmp isr_common
isr96:
	cli
	push 0
	push 96
	jmp isr_common
isr97:
	cli
	push 0
	push 97
	jmp isr_common
isr98:
	cli
	push 0
	push 98
	jmp isr_common
isr99:
	cli
	push 0
	push 99
	jmp isr_common
isr100:
	cli
	push 0
	push 100
	jmp isr_common
isr101:
	cli
	push 0
	push 101
	jmp isr_common
isr102:
	cli
	push 0
	push 102
	jmp isr_common
isr103:
	cli
	push 0
	push 103
	jmp isr_common
isr104:
	cli
	push 0
	push 104
	jmp isr_common
isr105:
	cli
	push 0
	push 105
	jmp isr_common
isr106:
	cli
	push 0
	push 106
	jmp isr_common
isr107:
	cli
	push 0
	push 107
	jmp isr_common
isr108:
	cli
	push 0
	push 108
	jmp isr_common
isr109:
	cli
	push 0
	push 109
	jmp isr_common
isr110:
	cli
	push 0
	push 110
	jmp isr_common
isr111:
	cli
	push 0
	push 111
	jmp isr_common
isr112:
	cli
	push 0
	push 112
	jmp isr_common
isr113:
	cli
	push 0
	push 113
	jmp isr_common
isr114:
	cli
	push 0
	push 114
	jmp isr_common
isr115:
	cli
	push 0
	push 115
	jmp isr_common
isr116:
	cli
	push 0
	push 116
	jmp isr_common
isr117:
	cli
	push 0
	push 117
	jmp isr_common
isr118:
	cli
	push 0
	push 118
	jmp isr_common
isr119:
	cli
	push 0
	push 119
	jmp isr_common
isr120:
	cli
	push 0
	push 120
	jmp isr_common
isr121:
	cli
	push 0
	push 121
	jmp isr_common
isr122:
	cli
	push 0
	push 122
	jmp isr_common
isr123:
	cli
	push 0
	push 123
	jmp isr_common
isr124:
	cli
	push 0
	push 124
	jmp isr_common
isr125:
	cli
	push 0
	push 125
	jmp isr_common
isr126:
	cli
	push 0
	push 126
	jmp isr_common
isr127:
	cli
	push 0
	push 127
	jmp isr_common
isr128:
	cli
	push 0
	push 128
	jmp isr_common
isr129:
	cli
	push 0
	push 129
	jmp isr_common
isr130:
	cli
	push 0
	push 130
	jmp isr_common
isr131:
	cli
	push 0
	push 131
	jmp isr_common
isr132:
	cli
	push 0
	push 132
	jmp isr_common
isr133:
	cli
	push 0
	push 133
	jmp isr_common
isr134:
	cli
	push 0
	push 134
	jmp isr_common
isr135:
	cli
	push 0
	push 135
	jmp isr_common
isr136:
	cli
	push 0
	push 136
	jmp isr_common
isr137:
	cli
	push 0
	push 137
	jmp isr_common
isr138:
	cli
	push 0
	push 138
	jmp isr_common
isr139:
	cli
	push 0
	push 139
	jmp isr_common
isr140:
	cli
	push 0
	push 140
	jmp isr_common
isr141:
	cli
	push 0
	push 141
	jmp isr_common
isr142:
	cli
	push 0
	push 142
	jmp isr_common
isr143:
	cli
	push 0
	push 143
	jmp isr_common
isr144:
	cli
	push 0
	push 144
	jmp isr_common
isr145:
	cli
	push 0
	push 145
	jmp isr_common
isr146:
	cli
	push 0
	push 146
	jmp isr_common
isr147:
	cli
	push 0
	push 147
	jmp isr_common
isr148:
	cli
	push 0
	push 148
	jmp isr_common
isr149:
	cli
	push 0
	push 149
	jmp isr_common
isr150:
	cli
	push 0
	push 150
	jmp isr_common
isr151:
	cli
	push 0
	push 151
	jmp isr_common
isr152:
	cli
	push 0
	push 152
	jmp isr_common
isr153:
	cli
	push 0
	push 153
	jmp isr_common
isr154:
	cli
	push 0
	push 154
	jmp isr_common
isr155:
	cli
	push 0
	push 155
	jmp isr_common
isr156:
	cli
	push 0
	push 156
	jmp isr_common
isr157:
	cli
	push 0
	push 157
	jmp isr_common
isr158:
	cli
	push 0
	push 158
	jmp isr_common
isr159:
	cli
	push 0
	push 159
	jmp isr_common
isr160:
	cli
	push 0
	push 160
	jmp isr_common
isr161:
	cli
	push 0
	push 161
	jmp isr_common
isr162:
	cli
	push 0
	push 162
	jmp isr_common
isr163:
	cli
	push 0
	push 163
	jmp isr_common
isr164:
	cli
	push 0
	push 164
	jmp isr_common
isr165:
	cli
	push 0
	push 165
	jmp isr_common
isr166:
	cli
	push 0
	push 166
	jmp isr_common
isr167:
	cli
	push 0
	push 167
	jmp isr_common
isr168:
	cli
	push 0
	push 168
	jmp isr_common
isr169:
	cli
	push 0
	push 169
	jmp isr_common
isr170:
	cli
	push 0
	push 170
	jmp isr_common
isr171:
	cli
	push 0
	push 171
	jmp isr_common
isr172:
	cli
	push 0
	push 172
	jmp isr_common
isr173:
	cli
	push 0
	push 173
	jmp isr_common
isr174:
	cli
	push 0
	push 174
	jmp isr_common
isr175:
	cli
	push 0
	push 175
	jmp isr_common
isr176:
	cli
	push 0
	push 176
	jmp isr_common
isr177:
	cli
	push 0
	push 177
	jmp isr_common
isr178:
	cli
	push 0
	push 178
	jmp isr_common
isr179:
	cli
	push 0
	push 179
	jmp isr_common
isr180:
	cli
	push 0
	push 180
	jmp isr_common
isr181:
	cli
	push 0
	push 181
	jmp isr_common
isr182:
	cli
	push 0
	push 182
	jmp isr_common
isr183:
	cli
	push 0
	push 183
	jmp isr_common
isr184:
	cli
	push 0
	push 184
	jmp isr_common
isr185:
	cli
	push 0
	push 185
	jmp isr_common
isr186:
	cli
	push 0
	push 186
	jmp isr_common
isr187:
	cli
	push 0
	push 187
	jmp isr_common
isr188:
	cli
	push 0
	push 188
	jmp isr_common
isr189:
	cli
	push 0
	push 189
	jmp isr_common
isr190:
	cli
	push 0
	push 190
	jmp isr_common
isr191:
	cli
	push 0
	push 191
	jmp isr_common
isr192:
	cli
	push 0
	push 192
	jmp isr_common
isr193:
	cli
	push 0
	push 193
	jmp isr_common
isr194:
	cli
	push 0
	push 194
	jmp isr_common
isr195:
	cli
	push 0
	push 195
	jmp isr_common
isr196:
	cli
	push 0
	push 196
	jmp isr_common
isr197:
	cli
	push 0
	push 197
	jmp isr_common
isr198:
	cli
	push 0
	push 198
	jmp isr_common
isr199:
	cli
	push 0
	push 199
	jmp isr_common
isr200:
	cli
	push 0
	push 200
	jmp isr_common
isr201:
	cli
	push 0
	push 201
	jmp isr_common
isr202:
	cli
	push 0
	push 202
	jmp isr_common
isr203:
	cli
	push 0
	push 203
	jmp isr_common
isr204:
	cli
	push 0
	push 204
	jmp isr_common
isr205:
	cli
	push 0
	push 205
	jmp isr_common
isr206:
	cli
	push 0
	push 206
	jmp isr_common
isr207:
	cli
	push 0
	push 207
	jmp isr_common
isr208:
	cli
	push 0
	push 208
	jmp isr_common
isr209:
	cli
	push 0
	push 209
	jmp isr_common
isr210:
	cli
	push 0
	push 210
	jmp isr_common
isr211:
	cli
	push 0
	push 211
	jmp isr_common
isr212:
	cli
	push 0
	push 212
	jmp isr_common
isr213:
	cli
	push 0
	push 213
	jmp isr_common
isr214:
	cli
	push 0
	push 214
	jmp isr_common
isr215:
	cli
	push 0
	push 215
	jmp isr_common
isr216:
	cli
	push 0
	push 216
	jmp isr_common
isr217:
	cli
	push 0
	push 217
	jmp isr_common
isr218:
	cli
	push 0
	push 218
	jmp isr_common
isr219:
	cli
	push 0
	push 219
	jmp isr_common
isr220:
	cli
	push 0
	push 220
	jmp isr_common
isr221:
	cli
	push 0
	push 221
	jmp isr_common
isr222:
	cli
	push 0
	push 222
	jmp isr_common
isr223:
	cli
	push 0
	push 223
	jmp isr_common
isr224:
	cli
	push 0
	push 224
	jmp isr_common
isr225:
	cli
	push 0
	push 225
	jmp isr_common
isr226:
	cli
	push 0
	push 226
	jmp isr_common
isr227:
	cli
	push 0
	push 227
	jmp isr_common
isr228:
	cli
	push 0
	push 228
	jmp isr_common
isr229:
	cli
	push 0
	push 229
	jmp isr_common
isr230:
	cli
	push 0
	push 230
	jmp isr_common
isr231:
	cli
	push 0
	push 231
	jmp isr_common
isr232:
	cli
	push 0
	push 232
	jmp isr_common
isr233:
	cli
	push 0
	push 233
	jmp isr_common
isr234:
	cli
	push 0
	push 234
	jmp isr_common
isr235:
	cli
	push 0
	push 235
	jmp isr_common
isr236:
	cli
	push 0
	push 236
	jmp isr_common
isr237:
	cli
	push 0
	push 237
	jmp isr_common
isr238:
	cli
	push 0
	push 238
	jmp isr_common
isr239:
	cli
	push 0
	push 239
	jmp isr_common
isr240:
	cli
	push 0
	push 240
	jmp isr_common
isr241:
	cli
	push 0
	push 241
	jmp isr_common
isr242:
	cli
	push 0
	push 242
	jmp isr_common
isr243:
	cli
	push 0
	push 243
	jmp isr_common
isr244:
	cli
	push 0
	push 244
	jmp isr_common
isr245:
	cli
	push 0
	push 245
	jmp isr_common
isr246:
	cli
	push 0
	push 246
	jmp isr_common
isr247:
	cli
	push 0
	push 247
	jmp isr_common
isr248:
	cli
	push 0
	push 248
	jmp isr_common
isr249:
	cli
	push 0
	push 249
	jmp isr_common
isr250:
	cli
	push 0
	push 250
	jmp isr_common
isr251:
	cli
	push 0
	push 251
	jmp isr_common
isr252:
	cli
	push 0
	push 252
	jmp isr_common
isr253:
	cli
	push 0
	push 253
	jmp isr_common
isr254:
	cli
	push 0
	push 254
	jmp isr_common
isr255:
	cli
	push 0
	push 255
	jmp isr_common

extern InterruptHandler

isr_common:
	mov rdi, rsp

	push r15
    push r14
    push r13
    push r12
    push r11
    push r10
    push r9
    push r8
    push rbp
    push rdi
    push rsi
    push rdx
    push rcx
    push rbx
    push rax

    cld

	call InterruptHandler

	mov rdi, rax
isr_done:
	mov rsp, rdi
	pop rax
    pop rbx
    pop rcx
    pop rdx
    pop rsi
	pop rdi
    pop rbp
    pop r8
    pop r9
    pop r10
    pop r11
    pop r12
    pop r13
    pop r14
    pop r15

    iretq


; Vector table

section .data
global isr_table
isr_table:
  dq isr0
  dq isr1
  dq isr2
  dq isr3
  dq isr4
  dq isr5
  dq isr6
  dq isr7
  dq isr8
  dq isr9
  dq isr10
  dq isr11
  dq isr12
  dq isr13
  dq isr14
  dq isr15
  dq isr16
  dq isr17
  dq isr18
  dq isr19
  dq isr20
  dq isr21
  dq isr22
  dq isr23
  dq isr24
  dq isr25
  dq isr26
  dq isr27
  dq isr28
  dq isr29
  dq isr30
  dq isr31
  dq isr32
  dq isr33
  dq isr34
  dq isr35
  dq isr36
  dq isr37
  dq isr38
  dq isr39
  dq isr40
  dq isr41
  dq isr42
  dq isr43
  dq isr44
  dq isr45
  dq isr46
  dq isr47
  dq isr48
  dq isr49
  dq isr50
  dq isr51
  dq isr52
  dq isr53
  dq isr54
  dq isr55
  dq isr56
  dq isr57
  dq isr58
  dq isr59
  dq isr60
  dq isr61
  dq isr62
  dq isr63
  dq isr64
  dq isr65
  dq isr66
  dq isr67
  dq isr68
  dq isr69
  dq isr70
  dq isr71
  dq isr72
  dq isr73
  dq isr74
  dq isr75
  dq isr76
  dq isr77
  dq isr78
  dq isr79
  dq isr80
  dq isr81
  dq isr82
  dq isr83
  dq isr84
  dq isr85
  dq isr86
  dq isr87
  dq isr88
  dq isr89
  dq isr90
  dq isr91
  dq isr92
  dq isr93
  dq isr94
  dq isr95
  dq isr96
  dq isr97
  dq isr98
  dq isr99
  dq isr100
  dq isr101
  dq isr102
  dq isr103
  dq isr104
  dq isr105
  dq isr106
  dq isr107
  dq isr108
  dq isr109
  dq isr110
  dq isr111
  dq isr112
  dq isr113
  dq isr114
  dq isr115
  dq isr116
  dq isr117
  dq isr118
  dq isr119
  dq isr120
  dq isr121
  dq isr122
  dq isr123
  dq isr124
  dq isr125
  dq isr126
  dq isr127
  dq isr128
  dq isr129
  dq isr130
  dq isr131
  dq isr132
  dq isr133
  dq isr134
  dq isr135
  dq isr136
  dq isr137
  dq isr138
  dq isr139
  dq isr140
  dq isr141
  dq isr142
  dq isr143
  dq isr144
  dq isr145
  dq isr146
  dq isr147
  dq isr148
  dq isr149
  dq isr150
  dq isr151
  dq isr152
  dq isr153
  dq isr154
  dq isr155
  dq isr156
  dq isr157
  dq isr158
  dq isr159
  dq isr160
  dq isr161
  dq isr162
  dq isr163
  dq isr164
  dq isr165
  dq isr166
  dq isr167
  dq isr168
  dq isr169
  dq isr170
  dq isr171
  dq isr172
  dq isr173
  dq isr174
  dq isr175
  dq isr176
  dq isr177
  dq isr178
  dq isr179
  dq isr180
  dq isr181
  dq isr182
  dq isr183
  dq isr184
  dq isr185
  dq isr186
  dq isr187
  dq isr188
  dq isr189
  dq isr190
  dq isr191
  dq isr192
  dq isr193
  dq isr194
  dq isr195
  dq isr196
  dq isr197
  dq isr198
  dq isr199
  dq isr200
  dq isr201
  dq isr202
  dq isr203
  dq isr204
  dq isr205
  dq isr206
  dq isr207
  dq isr208
  dq isr209
  dq isr210
  dq isr211
  dq isr212
  dq isr213
  dq isr214
  dq isr215
  dq isr216
  dq isr217
  dq isr218
  dq isr219
  dq isr220
  dq isr221
  dq isr222
  dq isr223
  dq isr224
  dq isr225
  dq isr226
  dq isr227
  dq isr228
  dq isr229
  dq isr230
  dq isr231
  dq isr232
  dq isr233
  dq isr234
  dq isr235
  dq isr236
  dq isr237
  dq isr238
  dq isr239
  dq isr240
  dq isr241
  dq isr242
  dq isr243
  dq isr244
  dq isr245
  dq isr246
  dq isr247
  dq isr248
  dq isr249
  dq isr250
  dq isr251
  dq isr252
  dq isr253
  dq isr254
  dq isr255
